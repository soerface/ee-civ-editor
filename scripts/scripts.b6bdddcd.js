"use strict";angular.module("eeCivEditorApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("eeCivEditorApp").controller("MainCtrl",["$scope","$rootScope","$http","$timeout",function(a,b,c,d){function e(){var b=[];for(var c in a.selectedBonuses)if(a.selectedBonuses.hasOwnProperty(c))for(var d in a.selectedBonuses[c])a.selectedBonuses[c].hasOwnProperty(d)&&b.push(a.selectedBonuses[c][d]);return b}function f(){var b=e(),c=new Uint8Array(4+a.civilizationName.length+4+4*b.length),d=0;c[d]=a.civilizationName.length,d+=4;for(var f=0;f<a.civilizationName.length;f++)c[d]=a.civilizationName.charCodeAt(f),d+=1;c[d]=b.length,d+=4;for(var g in b)b.hasOwnProperty(g)&&(c[d]=parseInt(b[g].hexcode.substr(0,2),16),d++,c[d]=parseInt(b[g].hexcode.substr(2,2),16),d++,d+=2);return new Blob([c],{type:"application/octet-stream"})}try{a.selectedBonuses=JSON.parse(localStorage.getItem("selectedBonuses"))||{}}catch(g){a.selectedBonuses={}}a.currentGame=localStorage.getItem("currentGame"),a.civInfo=JSON.parse(localStorage.getItem("civInfo")),a.civInfo||c({method:"GET",url:"civ_info.json"}).success(function(b){a.civInfo=b,localStorage.setItem("civInfo",JSON.stringify(b))}),a.civilizationName=localStorage.getItem("civName")||"",a.$watch("civilizationName",function(a){localStorage.setItem("civName",a)}),a.selectGame=function(b){function c(){a.civilizationName=a.civilizationName+e[0],e=e.slice(1,e.length),e.length>0&&a.civilizationName.length+e.length===f&&d(c,50+300*Math.random()),a.focusCivName=!0}a.currentGame=b,localStorage.setItem("currentGame",a.currentGame);var e="Unnamed Civilization",f=e.length;d(c,1e3)},a.toggleAvailableCategory=function(b){a.civInfo.categories[b].show=!a.civInfo.categories[b].show},a.addBonus=function(b,c){a.selectedBonuses[b]=a.selectedBonuses[b]||[],a.selectedBonuses[b].push(c),localStorage.setItem("selectedBonuses",JSON.stringify(a.selectedBonuses))},a.removeBonus=function(b,c){var d=a.selectedBonuses[b].indexOf(c);a.selectedBonuses[b].splice(d,1),0===a.selectedBonuses[b].length&&delete a.selectedBonuses[b],localStorage.setItem("selectedBonuses",a.selectedBonuses)},a.getExtraCosts=function(b,c){var d=a.selectedBonuses[b];return void 0===d?0:(c=void 0===c?d.length:c,c*a.civInfo.categories[b].category_cost)},a.getCosts=function(b,c,d){return b.costs+a.getExtraCosts(c,d)},a.getSelectedCosts=function(b){var c=a.selectedBonuses[b],d=0;for(var e in c)c.hasOwnProperty(e)&&(d+=a.getCosts(c[e],b,e));return d},a.getTotalCosts=function(){var b=0;for(var c in a.selectedBonuses)a.selectedBonuses.hasOwnProperty(c)&&(b+=a.getSelectedCosts(c));return b},a.getPointsLeft=function(){return 100-a.getTotalCosts()},a.downloadCiv=function(){var b=f();saveAs(b,a.civilizationName+".civ")}}]).directive("focusMe",function(){return{link:function(a,b,c){a.$watch(c.focusMe,function(d){d===!0&&(b[0].focus(),a[c.focusMe]=!1)})}}});